<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy Bird - é£æ‰¬çš„å°é¸Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        #gameContainer {
            position: relative;
            max-width: 100%;
            max-height: 100vh;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
        }

        canvas {
            display: block;
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 70%, #90EE90 100%);
            cursor: pointer;
            border-radius: 15px;
        }

        #startScreen, #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
            border-radius: 15px;
        }

        #startScreen h1, #gameOverScreen h1 {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            animation: bounce 1s infinite;
        }

        #startScreen p, #gameOverScreen p {
            font-size: 1.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        #score {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3em;
            color: white;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            font-weight: bold;
            z-index: 10;
        }

        #highScore {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .hidden {
            display: none !important;
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                padding: 0;
                margin: 0;
            }

            #gameContainer {
                max-width: 100vw;
                max-height: 100vh;
                width: 100vw;
                height: 100vh;
                box-shadow: none;
                border-radius: 0;
            }

            canvas {
                border-radius: 0;
                width: 100vw;
                height: 100vh;
            }

            #startScreen, #gameOverScreen {
                border-radius: 0;
            }

            #startScreen h1, #gameOverScreen h1 {
                font-size: 2em;
            }

            #startScreen p, #gameOverScreen p {
                font-size: 1em;
            }

            .btn {
                padding: 12px 30px;
                font-size: 1em;
            }

            #score {
                font-size: 2em;
                top: 15px;
            }

            #highScore {
                font-size: 1em;
                top: 55px;
            }
        }

        /* æ·»åŠ å°é¸Ÿå›¾æ ‡ */
        .bird-icon {
            font-size: 4em;
            animation: fly 0.5s infinite alternate;
        }

        @keyframes fly {
            from { transform: rotate(-10deg); }
            to { transform: rotate(10deg); }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>

        <div id="score" class="hidden">0</div>
        <div id="highScore" class="hidden"></div>

        <div id="startScreen">
            <div class="bird-icon">ğŸ¦</div>
            <h1>Flappy Bird</h1>
            <p>ç‚¹å‡»æˆ–æŒ‰ç©ºæ ¼é”®è®©å°é¸Ÿé£ç¿”</p>
            <p>ç©¿è¿‡ç®¡é“è·å¾—åˆ†æ•°</p>
            <button class="btn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
        </div>

        <div id="gameOverScreen" class="hidden">
            <div class="bird-icon">ğŸ’”</div>
            <h1>æ¸¸æˆç»“æŸ</h1>
            <p id="finalScore">åˆ†æ•°: 0</p>
            <p id="bestScore">æœ€é«˜åˆ†: 0</p>
            <button class="btn" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('highScore');

        // å“åº”å¼Canvaså°ºå¯¸
        function resizeCanvas() {
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const isMobile = windowWidth <= 768;

            if (isMobile) {
                // ç§»åŠ¨è®¾å¤‡ï¼šå æ»¡æ•´ä¸ªå±å¹•
                canvas.width = windowWidth;
                canvas.height = windowHeight;
            } else {
                // PCè®¾å¤‡ï¼šä¿æŒé™åˆ¶å°ºå¯¸
                const maxWidth = 500;
                const maxHeight = 700;

                let width = Math.min(maxWidth, windowWidth * 0.95);
                let height = Math.min(maxHeight, windowHeight * 0.9);

                // ä¿æŒå®½é«˜æ¯”
                const ratio = maxWidth / maxHeight;
                if (width / height > ratio) {
                    width = height * ratio;
                } else {
                    height = width / ratio;
                }

                canvas.width = width;
                canvas.height = height;
            }
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // æ¸¸æˆå˜é‡
        let bird = {
            x: 0,
            y: 0,
            radius: 0,
            velocity: 0,
            gravity: 0,
            jump: 0
        };

        let pipes = [];
        let score = 0;
        let highScore = localStorage.getItem('flappyHighScore') || 0;
        let gameState = 'start'; // start, ready, playing, gameOver
        let frameCount = 0;
        let pipeGap = 0;
        let pipeWidth = 0;
        let pipeSpeed = 0;

        function initGame() {
            // æ ¹æ®canvaså¤§å°è°ƒæ•´æ¸¸æˆå‚æ•°
            const scale = canvas.width / 500;

            bird = {
                x: canvas.width * 0.2,
                y: canvas.height / 2,
                radius: 15 * scale,
                velocity: 0,
                gravity: 0.1 * scale,
                jump: -4 * scale
            };

            pipes = [];
            score = 0;
            frameCount = 0;
            pipeGap = 300 * scale;
            pipeWidth = 60 * scale;
            pipeSpeed = 1.2 * scale;

            scoreElement.textContent = score;
            if (highScore > 0) {
                highScoreElement.textContent = `æœ€é«˜åˆ†: ${highScore}`;
            }
        }

        function startGame() {
            initGame();
            gameState = 'ready';
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            scoreElement.classList.remove('hidden');
            if (highScore > 0) {
                highScoreElement.classList.remove('hidden');
            }
            gameLoop();
        }

        function restartGame() {
            startGame();
        }

        function gameOver() {
            gameState = 'gameOver';
            gameOverScreen.classList.remove('hidden');
            document.getElementById('finalScore').textContent = `åˆ†æ•°: ${score}`;

            if (score > highScore) {
                highScore = score;
                localStorage.setItem('flappyHighScore', highScore);
            }
            document.getElementById('bestScore').textContent = `æœ€é«˜åˆ†: ${highScore}`;
        }

        // ç»˜åˆ¶å°é¸Ÿ
        function drawBird() {
            ctx.save();
            ctx.translate(bird.x, bird.y);

            // æ ¹æ®é€Ÿåº¦æ—‹è½¬å°é¸Ÿ
            const rotation = Math.min(Math.max(bird.velocity * 0.05, -0.5), 0.5);
            ctx.rotate(rotation);

            // ç»˜åˆ¶å°é¸Ÿèº«ä½“ï¼ˆæ¸å˜è‰²ï¼‰
            const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, bird.radius);
            gradient.addColorStop(0, '#FFD700');
            gradient.addColorStop(0.5, '#FFA500');
            gradient.addColorStop(1, '#FF8C00');

            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(0, 0, bird.radius, 0, Math.PI * 2);
            ctx.fill();

            // ç»˜åˆ¶å°é¸Ÿçœ¼ç›
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(bird.radius * 0.3, -bird.radius * 0.3, bird.radius * 0.3, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(bird.radius * 0.4, -bird.radius * 0.3, bird.radius * 0.15, 0, Math.PI * 2);
            ctx.fill();

            // ç»˜åˆ¶å°é¸Ÿå˜´å·´
            ctx.fillStyle = '#FF6347';
            ctx.beginPath();
            ctx.moveTo(bird.radius * 0.7, 0);
            ctx.lineTo(bird.radius * 1.2, -bird.radius * 0.1);
            ctx.lineTo(bird.radius * 1.2, bird.radius * 0.1);
            ctx.closePath();
            ctx.fill();

            ctx.restore();
        }

        // ç»˜åˆ¶ç®¡é“
        function drawPipe(pipe) {
            const gradient = ctx.createLinearGradient(pipe.x, 0, pipe.x + pipeWidth, 0);
            gradient.addColorStop(0, '#2ECC71');
            gradient.addColorStop(0.5, '#27AE60');
            gradient.addColorStop(1, '#229954');

            ctx.fillStyle = gradient;

            // ä¸Šæ–¹ç®¡é“
            ctx.fillRect(pipe.x, 0, pipeWidth, pipe.top);
            ctx.strokeStyle = '#1E8449';
            ctx.lineWidth = 3;
            ctx.strokeRect(pipe.x, 0, pipeWidth, pipe.top);

            // ç®¡é“é¡¶éƒ¨
            ctx.fillRect(pipe.x - 5, pipe.top - 20, pipeWidth + 10, 20);
            ctx.strokeRect(pipe.x - 5, pipe.top - 20, pipeWidth + 10, 20);

            // ä¸‹æ–¹ç®¡é“
            ctx.fillRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom);
            ctx.strokeRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom);

            // ç®¡é“åº•éƒ¨
            ctx.fillRect(pipe.x - 5, pipe.bottom, pipeWidth + 10, 20);
            ctx.strokeRect(pipe.x - 5, pipe.bottom, pipeWidth + 10, 20);
        }

        // ç»˜åˆ¶èƒŒæ™¯è£…é¥°
        function drawBackground() {
            // ç»˜åˆ¶äº‘æœµ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            const cloudY = [50, 120, 200];
            const cloudX = [(frameCount * 0.2) % (canvas.width + 100) - 50,
                           (frameCount * 0.3) % (canvas.width + 100) - 50,
                           (frameCount * 0.25) % (canvas.width + 100) - 50];

            cloudX.forEach((x, i) => {
                ctx.beginPath();
                ctx.arc(x, cloudY[i], 25, 0, Math.PI * 2);
                ctx.arc(x + 20, cloudY[i], 30, 0, Math.PI * 2);
                ctx.arc(x + 40, cloudY[i], 25, 0, Math.PI * 2);
                ctx.fill();
            });

            // ç»˜åˆ¶åœ°é¢
            const groundHeight = 50;
            const groundY = canvas.height - groundHeight;

            const groundGradient = ctx.createLinearGradient(0, groundY, 0, canvas.height);
            groundGradient.addColorStop(0, '#8B7355');
            groundGradient.addColorStop(1, '#654321');

            ctx.fillStyle = groundGradient;
            ctx.fillRect(0, groundY, canvas.width, groundHeight);

            // ç»˜åˆ¶è‰åœ°çº¹ç†
            ctx.fillStyle = '#228B22';
            for (let i = 0; i < canvas.width; i += 20) {
                const offset = (frameCount + i) % 20;
                ctx.fillRect(i - offset, groundY, 10, 5);
            }
        }

        // æ›´æ–°æ¸¸æˆçŠ¶æ€
        function update() {
            if (gameState !== 'playing') return;

            // æ›´æ–°å°é¸Ÿ
            bird.velocity += bird.gravity;
            bird.y += bird.velocity;

            // æ£€æŸ¥è¾¹ç•Œ
            if (bird.y + bird.radius > canvas.height - 50 || bird.y - bird.radius < 0) {
                gameOver();
                return;
            }

            // ç”Ÿæˆç®¡é“
            if (frameCount % 150 === 0) {
                const minTop = 50;
                const maxTop = canvas.height - pipeGap - 100;
                const top = Math.random() * (maxTop - minTop) + minTop;

                pipes.push({
                    x: canvas.width,
                    top: top,
                    bottom: top + pipeGap,
                    passed: false
                });
            }

            // æ›´æ–°ç®¡é“
            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= pipeSpeed;

                // æ£€æŸ¥ç¢°æ’
                if (bird.x + bird.radius > pipes[i].x &&
                    bird.x - bird.radius < pipes[i].x + pipeWidth) {
                    if (bird.y - bird.radius < pipes[i].top ||
                        bird.y + bird.radius > pipes[i].bottom) {
                        gameOver();
                        return;
                    }
                }

                // è®¡åˆ†
                if (!pipes[i].passed && bird.x > pipes[i].x + pipeWidth) {
                    pipes[i].passed = true;
                    score++;
                    scoreElement.textContent = score;
                }

                // ç§»é™¤å±å¹•å¤–çš„ç®¡é“
                if (pipes[i].x + pipeWidth < 0) {
                    pipes.splice(i, 1);
                }
            }

            frameCount++;
        }

        // ç»˜åˆ¶æ¸¸æˆ
        function draw() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶èƒŒæ™¯æ¸å˜
            const bgGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            bgGradient.addColorStop(0, '#87CEEB');
            bgGradient.addColorStop(0.7, '#E0F6FF');
            bgGradient.addColorStop(1, '#90EE90');
            ctx.fillStyle = bgGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶èƒŒæ™¯è£…é¥°
            drawBackground();

            // ç»˜åˆ¶ç®¡é“
            pipes.forEach(pipe => drawPipe(pipe));

            // ç»˜åˆ¶å°é¸Ÿ
            drawBird();

            // åœ¨readyçŠ¶æ€æ˜¾ç¤ºæç¤º
            if (gameState === 'ready') {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.fillStyle = 'white';
                ctx.font = `bold ${canvas.width / 15}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 10;
                ctx.fillText('ç‚¹å‡»å±å¹•å¼€å§‹', canvas.width / 2, canvas.height / 2);
                ctx.shadowBlur = 0;
            }
        }

        // æ¸¸æˆå¾ªç¯
        function gameLoop() {
            update();
            draw();

            if (gameState === 'ready' || gameState === 'playing') {
                requestAnimationFrame(gameLoop);
            }
        }

        // æ§åˆ¶
        function jump() {
            if (gameState === 'playing') {
                bird.velocity = bird.jump;
            }
        }

        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                e.preventDefault();
                if (gameState === 'start') {
                    startGame();
                } else if (gameState === 'ready') {
                    gameState = 'playing';
                } else if (gameState === 'playing') {
                    jump();
                } else if (gameState === 'gameOver') {
                    restartGame();
                }
            }
        });

        // é¼ æ ‡/è§¦æ‘¸æ§åˆ¶
        canvas.addEventListener('click', () => {
            if (gameState === 'ready') {
                gameState = 'playing';
            } else if (gameState === 'playing') {
                jump();
            }
        });

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameState === 'ready') {
                gameState = 'playing';
            } else if (gameState === 'playing') {
                jump();
            }
        });

        // åˆå§‹åŒ–
        initGame();
    </script>
</body>
</html>
